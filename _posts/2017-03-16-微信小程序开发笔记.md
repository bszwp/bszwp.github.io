---
layout: post
title: "微信小程序开发笔记"
date: 2017-03-16
tags: 小程序
---

[TOC]

### 安装微信开发者工具

下载地址 : https://mp.weixin.qq.com/debug/wxadoc/dev/devtools/download.html

注册微信小程序账号获取AppId

### 新建小程序

#### 文件结构

- app.js、app.json、app.wxss 程序整体配置、结构与样式
- utils 工具


- pages 存放页面
  - 结构 wxml
  - 样式 wxss
  - 行为 js
  - 属性 json

#### 配置

##### app.json

```json
{
  //注册页面，第一条为默认进入页面
  "pages": [
    "pages/home/home",
    "pages/index/index",
    "pages/logs/logs"
  ],
  //视口配置
  "window": {
    "navigationBarBackgroundColor": "rgb(26,188,156)",//导航栏背景
    "navigationBarTitleText": "昱之家",//显示的APP名字
    "navigationBarTextStyle": "light",//导航栏标题颜色 black/white
    "enablePullDownRefresh": true,//下拉刷新
    "backgroundTextStyle": "dark",//下拉加载样式 dark/light
    "backgroundColor": "rgb(26,188,140)"//下拉刷新背景色
  },
  //tabBar配置
  "tabBar": {
    "list": [{
      "pagePath": "pages/index/index",
      "text": "首页",
      "iconPath": "img/main_tab_home.png",
      "selectedIconPath": "img/main_tab_home_click.png"
    },
    {
      "pagePath": "pages/home/home",
      "text": "我的",
      "iconPath": "img/main_tab_my.png",
      "selectedIconPath": "img/main_tab_my_click.png"
    }],
    "color": "#333",
    "selectedColor": "rgb(26,188,156)",
    "backgroundColor": "#f0f0f0",
    "borderStyle": "white",
    "position": "bottom"
  },
  "debug" : false
}
```

单独页面文件夹下的json文件可以覆盖app.json文件下的window选项，如index.json

```json
{
  "enablePullDownRefresh": false
}
```

#### 一些注意的地方

1. 在页面文件夹中添加了json文件一定要在内容中加入`{ } ` 否则报错

2. 在页面文件夹中添加了js文件一定要在内容中加入 `Page({ })` 否则报错




### 生命周期

app的生命周期，在app.js中编写

```javascript
//注册一个小程序应用
//生命周期
App({
    onLaunch : function(){
        // 当小程序启动会触发，全局只会触发一次
        console.log("=== App onLaunch ===");
    },
    onHide : function(){
        // 当小程序置于后台的时候触发
        console.log("=== App onHide ===");
    },
    onShow : function(){
        // 当重新打开小程序的时候触发
        console.log("=== App onShow ===");
    },
    onError : function(){
        // 当小程序发生错误时触发
        console.log("=== App onError ===");
    },
    // 全局方法和变量
    add : function(a,b){
        console.log(a+b);
    },
    obj : {
        name : "qzy",
        age : 20
    }
});
```

page的生命周期，在页面文件夹的js中编写

```javascript
// 注册一个小程序页面
Page({
    data : {
        "name" : "qzy",
        "age" : 20
    },
    // 生命周期
    onLoad : function(){
        //当页面加载的时候触发
        console.log("=== Page onLoad ===");
    },
    onReady : function(){
        //当页面加载完毕触发
        console.log("=== Page onReady ===");
    },
    onShow : function(){
        //当返回当前页面时触发
        console.log("=== Page onShow ===");
    },
    onHide : function(){
        //当离开当前页面的时候触发
        console.log("=== Page onHide ===");
    },
    onUnload : function(){
        //退出小程序时触发
        console.log("=== Page onUnload ===");
    },
    onPullDownRefresh : function(){
        //下拉刷新
        console.log("=== Page onPullDownRefresh ===");
    },
    onReachBottom : function(){
        //当页面滚动到底部
        console.log("=== Page onReachBottom ===");
    },
    onShareAppMessage : function(){
        //当点击分享的时候触发
        console.log("=== Page onShareAppMessage ===");
    }
})
```

### 接收全局变量

page.js

```javascript
//接收小程序全局变量
var app = getApp();

...

Page({
    data : {
        "name" : "全在昱",
        "age" : 18
    },
    onReady : function(){
        //当页面加载完毕触发
        console.log("=== Page onReady ===");
        console.log(app);
        app.add(1,2);
        console.log(app.obj.name);
        // setData() 可以动态改变data中的参数，this代表当前页面
        this.setData({
            name : app.obj.name,
            age : app.obj.age
        });
    }
})
```

page.wxml

```html
<view class='box'>
    <!--数据模板-->
    <text>{{name}}</text>
    <text>{{age}}</text>
</view>
```

page.wxss

```css
/* 水平垂直居中 */
.box{
    width: 370rpx;
    height: 500rpx;
    background-color: #f00;
    position: absolute;
    top: 50%;
    left: 50%;
    margin-left: -185rpx;
    margin-top: -250rpx;
    color: white;
}
```

### util.js

可以通过工具暴露一些变量或方法

util.js

```javascript
function random(min,max){
  return Math.floor(Math.random() * (max-min) + min);
}

// 输入变量或方法
module.exports = {
  random : random
}
```

index.js

```javascript
// 加载一个模块
var util = require('../../utils/util.js');

// 注册一个页面
Page({
  data:{

  },
  onReady: function(){
    this.setData({
      num: util.random(100,500)
    });
  }
});
```

