---
layout: post
title: "Linux防火墙设置"
date: 2017-05-14
tags: Linux
---

### Linux防火墙操作

#### 1.重启后生效

​	开启： chkconfig iptables on 

​	关闭： chkconfig iptables off 

#### 2.即时生效

　　开启： service iptables start 

　　关闭： service iptables stop 

#### 3.配置文件

> vim /etc/sysconfig/iptables

​	修改/etc/sysconfig/iptables 文件，添加以下内容： 

　　-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT 开启80端口访问

　　-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT #开启22端口访问

​	-A INPUT -m state –state NEW -m tcp -p tcp –dport 443 -j ACCEPT #开启443端口访问

​	在-A RH-Firewall-1-INPUT -m state –state NEW -m tcp -p tcp –dport 22 -j ACCEPT前加#号注释掉，即可屏蔽默认的22端口访问

重启防火墙使得配置文件生效

> /etc/init.d/iptables restart



### CentOS7 下防火墙的操作

CentOS 7.0默认使用的是firewall作为防火墙，这里改为iptables防火墙步骤。

1、关闭firewall：

>systemctl stop firewalld.service #停止firewall
>
>systemctl disable firewalld.service #禁止firewall开机启动
>
>firewall-cmd --state #查看默认防火墙状态（关闭后显示notrunning，开启后显示running）



2、iptables防火墙（这里iptables已经安装，下面进行配置）
vi/etc/sysconfig/iptables #编辑防火墙配置文件

```
# sampleconfiguration for iptables service
# you can edit thismanually or use system-config-firewall
# please do not askus to add additional ports/services to this default configuration
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT[0:0]
:OUTPUT ACCEPT[0:0]
-A INPUT -m state--state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p icmp -jACCEPT
-A INPUT -i lo -jACCEPT
-A INPUT -p tcp -mstate --state NEW -m tcp --dport 22 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -jACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 8080-j ACCEPT
-A INPUT -j REJECT--reject-with icmp-host-prohibited
-A FORWARD -jREJECT --reject-with icmp-host-prohibited
COMMIT
:wq! #保存退出
```

备注：这里使用80和8080端口为例。***部分一般添加到“-A INPUT -p tcp -m state --state NEW -m tcp--dport 22 -j ACCEPT”行的上面或者下面，切记不要添加到最后一行，否则防火墙重启后不生效。
systemctlrestart iptables.service #最后重启防火墙使配置生效
systemctlenable iptables.service #设置防火墙开机启动



### Ubuntu下防火墙的操作

LInux原始的防火墙工具iptables由于过于繁琐,所以ubuntu系统默认提供了一个基于iptable之上的防火墙工具ufw。而UFW支持图形界面操作,只需在命令行运行ufw命令即能看到一系列的操作。

#### 1.安装与卸载

​	安装

> apt-get install iptables
>
> apt-get install ufw

​	卸载

> apt-get remove iptables
>
> apt-get remove ufw

#### 2.开启与关闭

​	关闭ubuntu的防火墙 : ufw disable
​	开启ubuntu的防火墙 : ufw enable

​	**启用ufw**
​	ufw enable
​	ufw default deny
​	运行以上两条命令后,开启了防火墙,并在系统启动时自动开启。关闭所有外部对本机的访问,但本机访问外部正常。

#### 3.常用操作

**开启和禁用**

> ufw allow \|deny [service]

**打开或关闭某个端口**

例如:

> ufw allow smtp　允许所有的外部IP访问本机的25/tcp (smtp)端口
>
> ufw allow 22/tcp 允许所有的外部IP访问本机的22/tcp (ssh)端口
>
> ufw allow 53 允许外部访问53端口(tcp/udp)
>
> ufw allow from 192.168.1.100 允许此IP访问所有的本机端口
>
> ufw allow proto udp 192.168.0.1 port 53 to 192.168.0.2 port 53
>
> ufw allow from 202.203.0.0 port 22 to 202.203.255.255 port 22
>
> sudo ufw deny smtp 禁止外部访问smtp服务
>
> sudo ufw delete allow smtp 删除上面建立的某条规则

**查看防火墙状态**

> ufw status

**允许某特定 IP**

> ufw allow from xxx.xxx.xx.xxx

**删除 smtp 端口的许可**

> ufw delete allow smtp
>
> ufw delete allow 22
>
> ufw delete allow allow from 202.203.0.0 port 22 to 202.203.255.255 port 22

![](http://ondh71tpt.bkt.clouddn.com/img/posts/02.png)

![](http://ondh71tpt.bkt.clouddn.com/img/posts/03.png)

![](http://ondh71tpt.bkt.clouddn.com/img/posts/04.png)



